<div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
  <h2 class="text-2xl font-semibold mb-6">Analytics for <%= link_to "#{request.base_url}/#{@url.short_code}", short_path(@url.short_code), target: "_blank", class: "text-blue-500" %></h2>

  <!-- Dropdown for selecting period -->
  <div class="mb-6">
    <label for="period" class="block text-gray-700 mb-2">Select Period:</label>
    <select id="period" name="period" onchange="location = this.value;">
      <option value="<%= analytics_path(@url) %>" <%= 'selected' if params[:period].blank? %>>Daily</option>
      <option value="<%= analytics_path(@url, period: 'month') %>" <%= 'selected' if params[:period] == 'month' %>>Monthly</option>
      <option value="<%= analytics_path(@url, period: 'year') %>" <%= 'selected' if params[:period] == 'year' %>>Year to Date</option>
    </select>
  </div>

  <div class="flex flex-wrap mb-6">
    <!-- Line Chart for Visit Counts -->
    <div class="w-full md:w-1/2 p-2">
      <h3 class="text-lg font-semibold mb-2">Visit Counts</h3>
      <%= line_chart @visit_counts, height: "300px", library: {
        title: { text: "Visits Over Time" },
        xAxis: { title: { text: "Date" } },
        yAxis: { title: { text: "Number of Visits" } }
      } %>
    </div>

    <!-- Pie Chart for Geographical Distribution -->
    <div class="w-full md:w-1/2 p-2">
      <h3 class="text-lg font-semibold mb-2">Geographical Distribution</h3>
      <%= pie_chart @geo_distribution, height: "300px", library: {
        title: { text: "Visits by Country" }
      } %>
    </div>
  </div>

  <!-- Visits Table -->
  <h3 class="text-xl font-semibold mb-4">All Visits</h3>
  <table class="min-w-full bg-white rounded shadow">
    <thead>
      <tr>
        <th class="py-2 px-4 border-b">Timestamp</th>
        <th class="py-2 px-4 border-b">Location</th>
        <th class="py-2 px-4 border-b">IP Address</th>
      </tr>
    </thead>
    <tbody>
      <% @visits.each do |visit| %>
        <tr>
          <td class="py-2 px-4 border-b"><%= visit.created_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
          <td class="py-2 px-4 border-b"><%= "#{visit.city}, #{visit.state}, #{visit.country}" %></td>
          <td class="py-2 px-4 border-b"><%= visit.ip_address %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
